<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Booking System</title>

<style>
  body {
    background:#eef2f3;
    font-family:Arial;
    margin:0;
    padding:20px;
  }

  .container {
    max-width:900px;
    margin:auto;
    background:white;
    padding:20px;
    border-radius:14px;
    box-shadow:0 5px 20px rgba(0,0,0,0.1);
  }

  h2 {
    text-align:center;
    color:#2c3e50;
    margin-bottom:15px;
  }

  .field {
    margin-top:12px;
  }

  label {
    font-weight:bold;
    display:block;
    margin-bottom:4px;
  }

  input, select {
    width:100%;
    padding:10px;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:16px;
  }

  button {
    width:100%;
    padding:12px;
    margin-top:20px;
    background:#3498db;
    color:white;
    border:none;
    border-radius:8px;
    font-size:18px;
    cursor:pointer;
  }
  button:hover { background:#2980b9; }

  #status {
    margin-top:15px;
    font-size:17px;
    font-weight:bold;
  }

  table {
    width:100%;
    border-collapse:collapse;
    margin-top:22px;
  }

  th {
    background:#3498db;
    color:white;
    padding:10px;
  }

  td {
    padding:10px;
    border:1px solid #ddd;
  }

  .available {
    background:#e8ffe8;
    color:green;
    font-weight:bold;
  }

  .booked {
    background:#ffe2e2;
    color:#d00000;
    font-weight:bold;
  }
</style>
</head>

<body>
<div class="container">

<h2>Open Booking System</h2>

<div class="field">
  <label>Select Date</label>
  <input type="date" id="date">
</div>

<div class="field">
  <label>Select Room</label>
  <select id="room">
    <option>101</option>
    <option>102</option>
    <option>103</option>
  </select>
</div>

<div class="field">
  <label>Select Slot</label>
  <select id="slot">
    <option>10:00–11:00</option>
    <option>11:00–12:00</option>
    <option>12:00–13:00</option>
    <option>13:00–14:00</option>
    <option>14:00–15:00</option>
  </select>
</div>

<div class="field">
  <label>Your Name</label>
  <input type="text" id="name">
</div>

<button onclick="book()">Book Slot</button>

<div id="status"></div>

<h3>Bookings</h3>
<div id="tableDiv">Loading...</div>

</div>

<script>
const api = "https://script.google.com/macros/s/AKfycbxzidQsMYaLgUudUz9jX-TpQDZJDrfizhK04N7YjDkgM7r5AsImsZQTTD8aLFlufkw-SA/exec";  // <-- paste your /exec URL here

let allBookings = [];
const today = new Date().toISOString().split("T")[0];
document.getElementById("date").min = today;

// Reload booked slots when user changes date/room
document.getElementById("date").addEventListener("change", updateSlotState);
document.getElementById("room").addEventListener("change", updateSlotState);

// Fetch all bookings
async function loadBookings() {
  const res = await fetch(api);
  allBookings = await res.json();

  renderTable();
  updateSlotState();
}

// Show bookings table
function renderTable() {
  if (!allBookings.length) {
    document.getElementById("tableDiv").innerHTML = "No bookings yet.";
    return;
  }

  let html = `<table>
    <tr><th>Date</th><th>Room</th><th>Slot</th><th>Name</th></tr>`;

  allBookings.forEach(b => {
    html += `<tr>
      <td>${b.Date}</td>
      <td>${b.Room}</td>
      <td>${b.Slot}</td>
      <td>${b.Name}</td>
    </tr>`;
  });

  html += `</table>`;
  document.getElementById("tableDiv").innerHTML = html;
}

// Disable booked slots
function updateSlotState() {
  const d = document.getElementById("date").value;
  const r = document.getElementById("room").value;
  const slotSel = document.getElementById("slot");

  const booked = new Set(
    allBookings
      .filter(b => b.Date === d && b.Room === r)
      .map(b => b.Slot)
  );

  for (let opt of slotSel.options) {
    if (booked.has(opt.value)) {
      opt.disabled = true;
      opt.textContent = opt.value + " (Booked)";
    } else {
      opt.disabled = false;
      opt.textContent = opt.value;
    }
  }
}

// Book a slot
async function book() {
  const date = document.getElementById("date").value;
  const room = document.getElementById("room").value;
  const slot = document.getElementById("slot").value;
  const name = document.getElementById("name").value.trim();

  if (!date || !name) {
    showStatus("Fill all fields!", "red");
    return;
  }

  const r = await fetch(api, {
    method: "POST",
    body: JSON.stringify({ date, room, slot, name })
  });

  const result = await r.json();

  if (result.status === "already_booked") {
    showStatus("This slot is already booked!", "red");
  } else {
    showStatus("Booking successful!", "green");
    loadBookings();
  }
}

// Show message
function showStatus(msg, color) {
  const s = document.getElementById("status");
  s.style.color = color;
  s.textContent = msg;
}

loadBookings();
</script>

</body>
</html>
